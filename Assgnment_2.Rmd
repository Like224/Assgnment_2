---
title: 'Assignment #2: Meta-analysis of Ocean Acidification Effects on Behaviour'
author: "Zirui Zhang u7457512"
date: "20/10/2022"
output: 
  bookdown::html_document2:
    code_folding: show
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
---
# **Statistical Analysis**
### 1.Install packages
```{r}
#Use  p_load function in the pacman to install and library a load of packages that we'll use.
library(pacman)
p_load(bookdown, tidyverse, ggforce, flextable, latex2exp, magick, plotrix, readxl, janitor, devtools,dplyr, gridExtra, cowplot, rstatix, GGally)
```

### 2.Import clark data into R, data Wrangling and generate the summary statistics for each of the fish species’ average activity for each treatment.
```{r}
#import clark data into R
path <- "OA_activitydat_20190302_BIOL3207.csv"
data_c <- read_csv(path)
#import metadata data into R
path_m <- "ocean_meta_data.csv"
meta_data <- read_csv(path_m)
#import paperdata into R
path_c <- "clark_paper_data.csv"
paper_data <- read_csv(path_c)
#Observe the structure of the  data
head(meta_data)
head(paper_data)
```

```{r}
#In comparison, the summary statistics for each of the fish species’ average activity for each treatment in meta_data are in one column, and we need to get the summary statistics data and divide them into different columns like the form of meta_data

#omit all rows with NA values in any column 
data_c <- na.omit(data_c)
# Drop irrelevant columns
new_data_c <- subset(data_c, select = -c(comment, loc))
# Check spelling in species and treatment 
unique(new_data_c$species)
unique(new_data_c$treatment)
```

```{r}
#seems no spelling error
#Generate a summary table of statistics (means, SD, N) for each of the fish species’ average activity for each treatment and divide them into different columns like the form of meta_data
mat <-   summarise_at(group_by(new_data_c,species,treatment),vars(activity),funs(mean(.,),sd(.,))) %>%
  pivot_wider(names_from = treatment, values_from = c(mean,sd))
id <- summarise_at(group_by(new_data_c,species,treatment),vars(animal_id),funs(length(unique(.,)))) %>%
  pivot_wider(names_from = treatment, values_from = c(animal_id))
#Combining these two sets of data together
data_2 <- merge(mat,id)
#Modify the column name of data_3 to make it the same as in the metadata
colnames(data_2) <- c("Species", "oa.mean","ctrl.mean","oa.sd","ctrl.sd","oa.n","ctrl.n")
data_2
```

### 2.Merge the summary statistics generated from 1) with the metadata.

```{r}
data_3 <- cbind(paper_data,data_2)
data_3
```
### 3.Merge the combined summary statistics and metadata into the larger meta-analysis dataset 
```{r}
data_f <- rbind(data_3,meta_data)
data_f
```

###4. Correctly calculate the log response ratio (lnRR) effect size for every row of the dataframe using metafor’s escalc() function.1